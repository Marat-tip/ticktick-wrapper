<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lists.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lists.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module Services */

const conn = require('./connection');
const utils = require('./utils');
const List = require('./list');

/**
 * Lists Service
 */
class Lists {
  constructor() {
    /**
     * Object with cached user lists where the key is the name of the list
     * @private
     * @member {Object.&lt;string, List>}
     */
    this._listsCache = {};

    /**
     * Last time {@link TickTick#_listsCache} was updated
     * @private
     * @member {Date}
     */
    this._listsCacheLastUpdate = undefined;

    this._refreshCache()
  }

  async _getAll(/* filter */) {
    const options = {
      uri: `${conn.baseUri}/projects`,
      json: true,
    };

    const rawLists = await conn.request(options);

    // map raw lists to object lists
    return rawLists.map(list => new List(list));
  }

  /**
   * Gets a list with a specific name
   * @param {string} name - The name of the list
   * @param {boolean=} forceRefresh - Whether to force a refresh of the cached lists
   * @returns {List|undefined}} {@link List} object or undefined if a list with the
   * provided name does not exist
   */
  async getByName(name, forceRefresh) {
    if (forceRefresh === true) {
      this._listsCacheLastUpdate = undefined;
    }

    await this._checkListsCache();
    return this._listsCache[name];
  }

  /**
   * Verify if the current lists cache has not expired. If it has expired, it will update
   * TickTick's list properties
   * @private
   */
  async _checkListsCache() {
    if (!utils.validateCache(this._listsCacheLastUpdate)) {
      this._refreshCache();

      const listsArray = await this._getAll();
      for (let i = 0; i &lt; listsArray.length; i += 1) {
        const current = listsArray[i];
        this._listsCache[current.name] = current;
      }

      this._listsCacheLastUpdate = new Date();
    }
  }

  /**
   * Verify if the current lists cache has not expired. If it has expired, it will update
   * TickTick's list properties
   * @private
   */
  _refreshCache() {
    this._listsCacheLastUpdate = undefined;
    this._listsCache = {};
  }

  /**
   * Gets a map of all lists available to the authenticated user
   * @param {boolean=} forceRefresh - Whether to force a refresh of the cached lists
   * @returns {Object.&lt;string, List>} Object with cached user lists where the key is
   * the name of the list
   */
  async getAll(forceRefresh) {
    if (forceRefresh === true) {
      this._refreshCache();
    }

    await this._checkListsCache();
    return this._listsCache;
  }
}

const lists = new Lists();
module.exports = lists;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Authentication.html">Authentication</a></li><li><a href="module-Models.html">Models</a></li><li><a href="module-Services.html">Services</a></li><li><a href="module-TickTick.html">TickTick</a></li><li><a href="module-Utils.html">Utils</a></li></ul><h3>Classes</h3><ul><li><a href="Connection.html">Connection</a></li><li><a href="module-Models-List.html">List</a></li><li><a href="module-Models-Reminder.html">Reminder</a></li><li><a href="module-Models-Task.html">Task</a></li><li><a href="module-Services-Lists.html">Lists</a></li><li><a href="module-Services-Tasks.html">Tasks</a></li><li><a href="module-TickTick-TickTick.html">TickTick</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Wed Jul 29 2020 18:26:15 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
